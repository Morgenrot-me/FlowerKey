# 后台服务目录说明

## 目录作用

Chrome Extension Service Worker，处理消息通信、右键菜单、解锁状态维护。

## 文件列表

| 文件 | 作用 |
|------|------|
| `service-worker.ts` | 唯一后台脚本：注册右键菜单、代理密码生成请求、管理 session 解锁状态 |

## 技术说明

- 使用 `chrome.storage.session` 存储解锁状态（浏览器关闭自动清除）
- `setPanelBehavior({ openPanelOnActionClick: true })` 实现点击工具栏图标自动打开侧边栏
- 消息类型：`getUnlockState` / `generatePassword` / `generatePasswordDirect` / `unlockFromContent` / `setSession`
- `generatePasswordDirect`：不要求已解锁，直接用传入的记忆密码生成，同时返回 `verified` 字段

## 注意事项

- Service Worker 无法直接调用 `chrome.sidePanel.open()`（用户手势上下文丢失），统一用 `setPanelBehavior` 代替
- 所有异步消息处理器必须 `return true` 保持通道开放
