# 核心库目录说明

## 目录作用

FlowerKey 的核心逻辑库，包含加密、数据层、数据模型，所有端（浏览器插件/桌面/移动）共享此库。

## 文件列表

| 文件 | 作用 |
|------|------|
| `src/index.ts` | 库入口，导出所有公共 API |
| `src/models.ts` | 数据模型定义（Entry、ChangeLog、UserConfig 等） |
| `src/crypto.ts` | 核心加密库（PBKDF2 密钥派生、HMAC-SHA256 密码生成、AES-256-GCM 加解密） |
| `src/db.ts` | 数据层（基于 Dexie.js 封装 IndexedDB，Entry CRUD + ChangeLog） |
| `package.json` | 包配置，依赖 dexie、uuid |
| `tsconfig.json` | TypeScript 编译配置 |

## 技术说明

- 加密全部基于 Web Crypto API，零外部依赖
- 密钥派生使用 PBKDF2-SHA256（600,000 次迭代）
- 数据加密使用 AES-256-GCM，格式：`[1B version][12B IV][ciphertext+tag]`
- 密钥分离原则：验证哈希、主密钥、数据库密钥使用不同盐前缀

## 扩展方式

- 新增数据模型：在 `models.ts` 中添加接口定义
- 新增加密功能：在 `crypto.ts` 中添加函数并从 `index.ts` 导出
- 新增数据库表：在 `db.ts` 的 `FlowerKeyDB` 类中添加

## 注意事项

- 所有异步加密操作返回 Promise
- `db.ts` 中的写操作自动记录 ChangeLog（用于增量同步）
- 修改数据库 schema 需要增加 Dexie version 号
