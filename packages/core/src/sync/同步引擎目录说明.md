# 同步引擎目录说明

## 目录作用

WebDAV 增量同步引擎，实现多端数据同步，支持离线操作、冲突解决、端到端加密。

## 文件列表

| 文件 | 作用 |
|------|------|
| `engine.ts` | 同步主逻辑：协调拉取/推送流程，管理同步锁，触发 oplog 压缩 |
| `webdav.ts` | WebDAV 客户端封装：上传/下载/检查 .enc 文件，兼容坚果云等服务 |
| `changelog.ts` | 变更日志管理：收集未同步的 ChangeLog，序列化/反序列化 oplog |

## 技术说明

- 冲突解决策略：Last-Write-Wins（以 `updatedAt` 时间戳为准）
- 远端目录结构：`/VaultSync/oplog/{deviceId}_{timestamp}.enc`
- 所有 `.enc` 文件使用 AES-256-GCM 加密，格式：`[1B version][12B IV][ciphertext+tag]`
- 同步锁文件 `sync.lock` 明文存储，60 秒过期，兼容不支持 LOCK 方法的服务
- oplog 文件超过 20 个时自动压缩为全量快照 `vault.enc`

## 注意事项

- 坚果云 API 频率限制：每 30 分钟 600 次，同步间隔建议 ≥ 5 分钟
- `salt.dat` 明文存储（新设备加入时需要），不含敏感信息
